{#
| Variable                               | Type                        | Description                                                            |
|----------------------------------------|-----------------------------|------------------------------------------------------------------------|
| page                                   | object                      |                                                                        |
| page.title                             | string                      | *could be html                                                         |
| page.slug                              | string                      | ex: "cat.show"                                                         |
| product                                | Product                     |                                                                        |
| product.id                             | int                         |                                                                        |
| product.name                           | string                      |                                                                        |
| product.description                    | string                      | HTML                                                                   |
| product.url                            | string                      |                                                                        |
| product.promotion_title                | string                      |                                                                        |
| product.subtitle                       | string                      |                                                                        |
| product.type                           | string                      | product, service, group_products, codes, digital, food, donating       |
| product.status                         | string                      | sale, out, out-and-notify                                              |
| product.weight                         | ?string                     |                                                                        |
| product.calories                       | ?float                      |                                                                        |
| product.sku                            | ?string                     |                                                                        |
| product.rating                         | ?Rating                     |                                                                        |
| product.rating.count                   | int                         |                                                                        |
| product.rating.stars                   | int                         |                                                                        |
| product.price                          | float                       | can be string too `-`, when merchant doesn't want to show zero         |
| product.sale_price                     | float                       |                                                                        |
| product.regular_price                  | float                       |                                                                        |
| product.starting_price                 | ?float                      |                                                                        |
| product.quantity                       | ?int                        | if it's null, means it's unlimited                                     |
| product.sold_quantity                  | int                         |                                                                        |
| product.max_quantity                   | int                         |                                                                        |
| product.discount_ends                  | ?date                       |                                                                        |
| product.is_taxable                     | bool                        | Is the tax included in the price                                       |
| product.category                       | ?Category                   |                                                                        |
| product.category.name                  | string                      |                                                                        |
| product.category.url                   | string                      |                                                                        |
| product.image                          | object                      |                                                                        |
| product.image.url                      | string                      |                                                                        |
| product.image.alt                      | ?string                     |                                                                        |
| product.images                         | array                       |                                                                        |
| product.images[].id                    | int                         |                                                                        |
| product.images[].url                   | string                      |                                                                        |
| product.images[].alt                   | ?string                     |                                                                        |
| product.images[].video_url             | ?string                     |                                                                        |
| product.images[].type                  | string                      | `image` `video`                                                        |
| product.brand                          | ?object                     |                                                                        |
| product.brand.id                       | int                         |                                                                        |
| product.brand.url                      | ?string                     |                                                                        |
| product.brand.name                     | ?string                     |                                                                        |
| product.brand.logo                     | ?string                     |                                                                        |
| product.tags                           | ?Tags[] *Collection         |                                                                        |
| product.tags[].name                    | string                      |                                                                        |
| product.tags[].url                     | string                      |                                                                        |
| product.options                        | ProductOption[] *Collection | @see views/pages/partials/product/options.twig                         |
| product.notify_availability            | ?object                     | does product outOfStock & can visitor subscribe to notify availability |
| product.notify_availability.channels   | array                       | ex: ['sms', 'email']                                                   |
| product.notify_availability.subscribed | bool                        | Does user subscribed before                                            |
| product.donation                       | ?ProductDonation            |                                                                        |
| product.donation.target_message        | ?string                     | Message if reached to target or target expired                         |
| product.donation.collected_amount      | float                       |                                                                        |
| product.donation.target_amount         | float                       |                                                                        |
| product.donation.target_percent        | float                       |                                                                        |
| product.donation.target_end_date       | ?Date                       |                                                                        |
| product.donation.can_donate            | bool                        | `true` When there is no campaign or (target not reached & not expired) |
| product.has_read_more                  | bool                        |                                                                        |
| product.can_add_note                   | bool                        |                                                                        |
| product.can_show_remained_quantity     | bool                        |                                                                        |
| product.can_show_sold                  | bool                        |                                                                        |
| product.can_upload_file                | bool                        |                                                                        |
| product.has_custom_form                | bool                        | Is it for  `Food` or `Custom Service` product                          |
| product.has_metadata                   | bool                        |                                                                        |
| product.has_options                    | bool                        |                                                                        |
| product.is_on_sale                     | bool                        | Product has discounted price                                           |
| product.is_hidden_quantity             | bool                        | The quantity is hidden by merchant, or product not available           |
| product.is_available                   | bool                        |                                                                        |
| product.is_in_wishlist                 | bool                        |                                                                        |
| product.is_out_of_stock                | bool                        |                                                                        |
| product.is_require_shipping            | bool                        |                                                                        |
| product.base_currency_price            | float                       | product.price with base currency (SAR)                                 |
| product.discount_percentage            | ?string                     | ex: "20%"                                                              |
| product.has_3d_image                   | bool                        |                                                                        |
| product.has_size_guide                 | bool                        |                                                                        |
| product.is_giftable                    | bool                        |                                                                        |
| product.add_to_cart_label              | string                      |                                                                        |
| product.currency                       | string                      |         discount_ends                                                               |
#}
{% extends "layouts.master" %}
{% block content %}
    <div class="container py-6">
  <nav class="flex items-center px-4 py-2 text-sm text-gray-600 bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-900 dark:text-gray-300 dark:border-gray-700 mb-6" aria-label="Breadcrumb">
    <salla-breadcrumb></salla-breadcrumb>
  </nav>

    
    <div class="flex flex-col md:flex-row md:space-x-8 rtl:md:space-x-reverse p-4 md:p-8" id="product-{{ product.id }}">
  
  <!-- Sidebar الصور -->
  <div class="sidebar w-full md:w-1/2 md:sticky top-24 overflow-hidden shrink-0 rounded-md shadow-md bg-white p-4">
      {% set has_many_images = product.images|length > 1 %}
      <salla-slider
          id="details-slider-{{ product.id }}"
          class="details-slider rounded-md image-slider"
          type="thumbs"
          loop="false"
          auto-height
          listen-to-thumbnails-option
          show-thumbs-controls="false">

          {% if product.promotion_title %}
          <span class="promotion-title-custom absolute top-3 right-3 z-10">
              <span class="text-xs w-fit block px-3 font-thin py-1 my-2 bg-gray-100 rounded-md">
                  {{ product.promotion_title }}
              </span>
          </span>                        
          {% endif %}

         
          {% if product.calories %}
          <div class="absolute z-20 top-4 rtl:left-4 ltr:right-4 bg-white shadow-sm flex flex-col justify-center items-center rounded-full w-20 h-20 md:w-24 md:h-24">
              <span class="text-red-500 text-xl font-bold">{{ product.calories }}</span>
              <span class="text-xs text-gray-500">{{ trans('pages.products.calories') }}</span>
          </div>
          {% endif %}

          <div slot="items">
              {% for image in product.images %}
                  {% if image.three_d_image_url %}
                      <model-viewer style="min-height: 500px;" class="swiper s-slider-container rounded-md"
                          loading="eager" camera-controls
                          touch-action="pan-y" auto-rotate
                          poster="{{ image.url }}"
                          src="{{ image.three_d_image_url }}"
                          shadow-intensity="1" alt="{{ image.alt }}">
                      </model-viewer>
                  {% else %}
                      <a data-fslightbox="product_{{ product.id }}"
                         data-img-id="{{ image.id }}"
                         data-slid-index="{{ loop.index-1 }}"{% if image.video_url %} data-video-src="{{ image.video_url }}"{% endif %}
                         data-caption="{{ image.alt }}"
                         data-infinite="false"
                         data-type="{{ image.video_url?'youtube':'image' }}"
                         href="{{ image.video_url?image.video_url:image.url }}"
                         aria-label="{{ product.name }}"
                         class="swiper-slide magnify-wrapper homeslider__slide {{ image.video_url?'video-entry':'' }}">
                          {% if loop.first %}
                              <img id="{{image.id}}" fetchpriority="high" loading="eager" src="{{ image.url }}"
                                   alt="{{ image.alt }}"
                                   class="h-full object-cover w-full rounded-md {{ image.three_d_image_url ? 'model-poster' : '' }}">
                          {% else %}
                              <img id="{{image.id}}" src="{{ 'images/s-empty.png' | cdn }}" data-src="{{ image.url }}"
                                   alt="{{ image.alt }}"
                                   class="lazy h-full object-cover w-full rounded-md {{ image.three_d_image_url ? 'model-poster' : '' }}">
                          {% endif %}
                      </a>
                  {% endif %}
              {% endfor %}
          </div>

          {% if has_many_images %}
          <div slot="thumbs" class="mt-4 grid grid-cols-4 gap-2">
              {% for image in product.images %}
                  <div class="slide--one-fourth {{ image.video_url?'video-entry':'' }} {{ image.three_d_image_url?'model-entry':'' }}">
                      {% if loop.index < 5 %}
                          <img src="{{ image.url }}"
                               loading="eager"
                               class="object-cover w-full h-20 md:h-24 rounded-md"
                               title="{{ image.alt }}"
                               alt="{{ image.alt }}" />
                      {% else %}
                          <img data-src="{{ image.url }}" src="{{ 'images/s-empty.png' | cdn }}"
                               class="object-cover w-full h-20 md:h-24 lazy rounded-md"
                               title="{{ image.alt }}"
                               alt="{{ image.alt }}" />
                      {% endif %}
                  </div>
              {% endfor %}
          </div>
          {% endif %}
      </salla-slider>
  </div>

  <!-- تفاصيل المنتج -->
  <div class="details w-full md:w-1/2 md:sticky top-24 overflow-auto bg-white p-4 rounded-md shadow-md mt-6 md:mt-0">
    {% hook 'product:single.description.start' %}

    {% if product.brand.name %}
      <div class="product-brand mb-5 w-24">
          <a class="brand-logo inline-block" href="{{ product.brand.url }}" title="{{ product.brand.name }}">
              <img class="max-h-16 object-contain" src="{{ product.brand.logo }}" alt="{{ product.brand.name }}" />
          </a>
      </div>
    {% endif %}

    {% if product.rating %}
      <salla-rating-stars value="{{ product.rating.stars }}" reviews="{{ product.rating.count }}"></salla-rating-stars>
    {% endif %}

    {% if product.is_taxable %}
      <small class="text-gray-500">{{ trans('pages.products.tax_included') }}</small>
    {% endif %}

    <h1 class="text-2xl font-bold mb-3 text-gray-800">{{ product.name }}</h1>

    {% if product.subtitle %}
      <h2 class="text-sm text-gray-500 mb-5">{{ product.subtitle }}</h2>
    {% endif %}

    {% if product.sold_quantity or product.can_show_remained_quantity %}
      <div class="flex flex-wrap gap-4 mb-5 text-sm text-gray-600">
        {% if product.sold_quantity %}
          <div class="flex items-center gap-1 text-red-700">
              <i class="sicon-fire"></i>
              {{ trans('pages.products.sold') }} {{ pluralize('pages.products.sold_times', product.sold_quantity)|raw }}
          </div>
        {% endif %}
        {% if product.can_show_remained_quantity %}
          <div class="flex items-center gap-1">
              <i class="sicon-box-bankers text-red-700"></i>
              {{ trans('pages.products.remained') }} {{ product.quantity }}
          </div>
        {% endif %}
      </div>
    {% endif %}

    <!-- السعر -->
    <div class="flex flex-wrap items-center gap-4 text-lg mb-6">
      <div class="{{ product.is_on_sale ? '' : 'hidden' }} flex items-baseline gap-3">
        <h4 class="text-red-800 font-bold text-xl">
          {{ product.sale_price|money|raw }}
        </h4>
        <span class="line-through text-gray-500 text-base">
          {{ product.regular_price|money|raw }}
        </span>
      </div>
      <div class="{{ product.is_on_sale ? 'hidden' : 'flex' }} items-baseline gap-3">
        {% if product.starting_price %}
          <span class="text-gray-600 text-sm">{{ trans('pages.products.starting_price') }}</span>
        {% endif %}
        <h2 class="font-bold text-xl">
          {{ product.starting_price ? product.starting_price|money|raw : product.price|money|raw }}
        </h2>
      </div>
    </div>

    {% hook 'product:single.description' %}

    <!-- خيارات المنتج -->
    <form class="product-form" enctype="multipart/form-data" method="post" onsubmit="return salla.form.onSubmit('cart.addItem', event)">
      <input type="hidden" name="id" value="{{ product.id }}">

      {% hook 'product:single.form.start' %}
      {% include 'pages.partials.product.options' %}
      {% hook 'product:single.form.end' %}

      <section class="mb-5">
        {% if product.is_hidden_quantity or product.type == 'booking' %}
          <input type="hidden" value="1" name="quantity" aria-label="Quantity"/>
        {% else %}
          <div class="flex items-center justify-between mb-4">
            <label class="font-bold">{{ trans('pages.products.quantity') }}</label>
            <salla-quantity-input max="{{ product.max_quantity }}" value="1" name="quantity" aria-label="Quantity" class="border-gray-200"></salla-quantity-input>
          </div>
        {% endif %}
      </section>

      <salla-add-product-button
          quick-buy
          support-sticky-bar
          {{product.is_require_shipping ? 'required-shipping' : ''}}
          amount="{{ product.base_currency_price }}"
          class="w-full mb-4"
          product-status="{{ product.status }}"
          product-type="{{ product.type }}"
          product-id="{{ product.id }}"
          loader-position="end"
          type="submit"
          width="wide"
          {% if product.notify_availability %}
              {{ product.notify_availability.subscribed ? 'is-subscribed' : '' }}
              channels="{{ product.notify_availability.channels|join(',') }}"
              subscribed-options="{{ product.notify_availability.subscribed_options|json_encode }}"
              {{ product.notify_availability.options ? 'notify-options-availability' : '' }}
          {% endif %}>
        {{ product.add_to_cart_label }}
      </salla-add-product-button>

      <div class="custom-bar mt-3 py-2 border-2 border-primary text-primary rounded-md text-center">
        <h3 class="text-xl font-bold mb-2">اعجبك المنتج؟</h3>
        <div class="flex justify-center items-center space-x-3 rtl:space-x-reverse">
          <salla-social-share aria-label="social share"></salla-social-share>
 <salla-button
              class="btn--wishlist animated sws absolute top-3 left-3 z-10"
              data-id="{{ product.id }}"
              onclick="salla.wishlist.toggle({{ product.id }})"
              shape="icon"
              fill="outline"
              color="light"
              aria-label="Add to wishlist">
              <i class="sicon-heart"></i>
          </salla-button>

          <salla-button
              class="btn--wishlist animated hidden sm:inline-flex"
              data-id="{{ product.id }}"
              onclick="salla.wishlist.toggle({{ product.id }})"
              shape="icon"
              fill="outline"
              color="light"
              aria-label="Add to wishlist">
            <i class="sicon-heart"></i>
          </salla-button>
        </div>
      </div>

      <div class="mt-4 text-base space-y-2">
        {% if product.sku %}
          <div class="flex items-center gap-2">
            <i class="sicon-barcode"></i>
            <span>{{ trans('pages.products.sku') }}:</span>
            <span class="font-mono">{{ product.sku }}</span>
          </div>
        {% endif %}

        {% if product.tags|length and theme.settings.get('show_tags', true) %}
          <div>
            {% for tag in product.tags %}
              <a href="{{ tag.url }}" class="inline-block text-gray-500 hover:text-primary text-sm mr-2 mb-1 px-2 py-1 border rounded">
                {{ tag.name }}
              </a>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      {% if product.is_giftable %}
        <salla-gifting class="mt-5" widget-subtitle="{{ gifting_intro }}" product-id="{{ product.id }}"></salla-gifting>
      {% endif %}
    </form>

    {% hook 'product:single.description.end' %}
    <salla-quick-order class="mt-5 md:-mb-2 block"></salla-quick-order>
  </div>
</div>

      

<div class="flex flex-col md:flex-row gap-6 p-4 sm:p-6 bg-white rounded-xl shadow-md">
    <div class="flex-1 md:w-1/2 md:pr-6 relative border-b border-gray-200 md:border-b-0 md:border-r pb-4 md:pb-0">
        <h2 class="text-lg sm:text-xl font-semibold mb-3">
            <span class="inline-block border-b-2 border-primary hover:text-primary transition-colors duration-200">
                {{ trans('pages.products.deschead') }}
            </span>
        </h2>

        <div class="product__description text-gray-700 leading-relaxed">
            {% set product_desc = product.description|replace({"&nbsp;":"\n"}) %}
            {% if product.has_read_more %}
                <article id="more-content"
                         class="article article--main relative overflow-hidden transition-all duration-300 max-h-[5.25rem] py-2">
                    {{ product_desc|raw }}
                </article>

                <a id="btn-show-more"
                   class="text-primary hover:underline inline-block mt-2 cursor-pointer transition duration-200">
                    {{ trans('pages.products.read_more') }}
                </a>
            {% else %}
                <article class="article--main pb-1">
                    {{ product_desc|raw }}
                </article>
            {% endif %}
        </div>
    </div>

    <div class="flex-1 md:w-1/2 md:pl-6 pt-4 md:pt-0">
        <h2 class="text-lg sm:text-xl font-semibold mb-3">
            <span class="inline-block border-b-2 border-primary hover:text-primary transition-colors duration-200">
                {{ trans('pages.products.commentshead') }}
            </span>
        </h2>

        <div class="comments-section">
            {% component 'comments' %}
        </div>
    </div>
</div>

            

        </div>
       
        <salla-offer></salla-offer>
    </div>


 
    <div class="container">
        <salla-products-slider source="related" source-value="{{product.id}}" block-title="{{trans('pages.products.similar_products')}}" display-all-url></salla-products-slider>
    </div>
{% endblock %}

{% block scripts %}
    <script defer src="{{ 'product.js' | asset }}"></script>
    {% if product.has_3d_image %}
        <script type="module" defer src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js" defer></script>
{% endblock %}


